+++
title= "LinuxTips15"
date = "2022-09-23T12:27:44+08:00"
description = "LinuxTips15"
keywords = ["Technology"]
categories = ["Technology"]
+++
### 1. x11docker
Start and specify vt:    

```
# x11docker --gpu --vt=2 --xorg x11docker/mate
```
With internet and more features:    

```
# x11docker --gpu --vt=2 --network --desktop --init=systemd x11docker/deepin
```

### 2. git without ssl check
via:    

```
export GIT_SSL_NO_VERIFY=1
git clone https://xxxx.xx
```

### 3. Home Sharing environment
Install dnsmasq and configure:    

```
# vim /etc/dnsmasq.conf
bind-interfaces
dhcp-range=10.1.10.128,10.1.10.200,12h
dhcp-option=3,10.1.10.1
dhcp-authoritative
interface=enp0s25
# systemctl restart dnsmasq
```
Start the sharing via(enp0s25->wlo1):    

```
$ sudo iptables -t nat -A POSTROUTING -s '10.1.10.0/24' -o wlo1 -j MASQUERADE
```
Then with a ethernet cable connected, the other client could get reach into
the internet via sharing.   

### 4. system_reset in qemu
via:    

```
telnet localhost 1111
> system_reset
this could reset the machine and let it reboot.
```

### 5. uhd510 win7 driver
download url:   

`https://downloadmirror.intel.com/30195/a08/win64_15.45.5174.exe`

### 6. intel graphics
version:   

```
21.20.16.5174 intel
```

### 7. Fix zsh issue
When type `tab` key in zsh shell, it will complains following arguments, and
won't automatically auto-complete the command:    

```
(eval):setopt:3: no such option: NO_typesettounset
```
Fixed via:    

```
# chsh -s $(which zsh)
# vim /etc/shells
/usr/bin/zsh
```
Reboot the machine and this issue fixed.    

### 8. Enter to M
`^M` will be replaced ,when hitting Enter:    

```
stty icrnl
```
### 9. wine with input method
Could not use fcitx in wine's tim:    

Add:   

```
export GTK_IM_MODULE=fcitx
export QT_IM_MODULE=fcitx
export XMODIFIERS=@im=fcitx
```
into `/opt/apps/com.qq.tim.spark/files/run.sh`
### 10. os-probe in archlinux
Add following lines into `/etc/default/grub`, then update grub configuration:      

```
GRUB_DISABLE_OS_PROBER=false
```

### 11. ubuntu upgrade issue
solved via:  

```
cd /var/lib/dpkg/info
sudo rm usrmerge.*
sudo apt-get -f install
```

### 12. ssh to dropbear
issue:    

```
Unable to negotiate with 192.168.1.1 port 22: no matching host key type found. Their offer: ssh-rsa
```
solved via:    

```
ssh  -oHostKeyAlgorithms=+ssh-rsa root@xxx.xxx.xxx.xxx
```

### 13. autologin xfce4
Edit lightdm configuration files:     

```
vi /etc/lightdm/lightdm.conf

[SeatDefaults]
autologin-user=username    #需要登录的用户名
autologin-user-timeout=delay

```

### 14. detect pci parameters
via:     

```
sudo lspci  -v -s 00:02.0
00:02.0 VGA compatible controller: Intel Corporation Device 9a49 (rev 01) (prog-if 00 [VGA controller])
	DeviceName: Onboard - Video
	Subsystem: Intel Corporation Device 3004
	Flags: bus master, fast devsel, latency 0, IRQ 190
	Memory at 603c000000 (64-bit, non-prefetchable) [size=16M]
	Memory at 4000000000 (64-bit, prefetchable) [size=256M]
	I/O ports at 3000 [size=64]
	Expansion ROM at 000c0000 [virtual] [disabled] [size=128K]
	Capabilities: [40] Vendor Specific Information: Len=0c <?>
	Capabilities: [70] Express Root Complex Integrated Endpoint, MSI 00
	Capabilities: [ac] MSI: Enable+ Count=1/1 Maskable+ 64bit-
	Capabilities: [d0] Power Management version 2
	Capabilities: [100] Process Address Space ID (PASID)
	Capabilities: [200] Address Translation Service (ATS)
	Capabilities: [300] Page Request Interface (PRI)
	Capabilities: [320] Single Root I/O Virtualization (SR-IOV)
	Kernel driver in use: i915
	Kernel modules: i915
```

### 15. dnf speed up
add following :    

```
# vim /etc/dnf/dnf.conf
fastestmirror=true


```

### 16. makepkg ignore check
via:    

```
makepkg --skipinteg
```

### 17. building on cdesktop
on building gstreamer:   

```
Force specify a macro. 
```

on building net-snmp:    

```
sudo apt install automake -y
aclocal
automake --add-missing --copy --force-missing
```

Detect pre-defined macros:    

```
uos@uos-PC:~$ echo | gcc -E -dM - | grep sw
#define __sw_64_bwx__ 1
#define __sw_64 1
#define __sw_64_fix__ 1
#define __sw_64_sw6b__ 1
#define __sw_64__ 1
#define __sw_64_cix__ 1

```

### 18. markdown in confluence
via:   

`https://www.cnblogs.com/cuianbing/p/15891950.html`

### 19. wine app fcitx
Added following in `run.sh`:    

```
env locale=zh_CN

export XIM="fcitx"
export GTK_IM_MODULE="fcitx"
export QT_IM_MODULE="fcitx"
export XMODIFIERS="@im=fcitx"
```

### 20. wine app fonts
Verify you have the correct fonts under :    

```
➜  Fonts pwd
/home/dash/.deepinwine/Spark-TIM/drive_c/windows/Fonts
➜  Fonts ls
simsunb.ttf  simsun.ttc

```
Then add following into the `run.sh`:    

```
env locale=zh_CN.UTF-8
export LC_ALL=zh_CN.UTF-8
LC_ALL=zh_CN.UTF-8
WINE_CMD="LC_ALL=zh_CN.UTF-8 deepin-wine5"

```

### 21. virtualbox time issue
Windows side:   

```
c:\Progra~1\Oracle\VirtualBox\VBoxManage setextradata %NOME% "VBoxInternal/Devices/VMMDev/0/Config/GetHostTimeDisabled" 1
c:\Progra~1\Oracle\VirtualBox\VBoxManage modifyvm %NOME% --biossystemtimeoffset -7628000000
```

### 22. python simple http server
via:    

```
python -m http.server 9000

```

### 23. build kernel 
`BTF: .tmp_vmlinux.btf: pahole (pahole) is not available`

```
sudo apt install dwarves
```

### 24. kernel install module
via:     

```
make INSTALL_MOD_STRIP=1 modules_install -j4
```
then the initrd size will be small. 
Or you will encounter initrd is too big issue.   
### 25. Auto restart sshd
via:    

```
pacman -S cron
systemctl enable cronie
crontab -e
@reboot sleep 120 && systemctl restart sshd
```
Then each time you reboot the machine it will automatically restart sshd.   

### 26. Install graphical in pve
Install kde via following command:    

```
apt install -y task-kde-desktop
```

### 27. RemoteDesktop GPU
via:    

```
显卡加速
win+r打开运行 输入gpedit.msc
依次找到计算机配置->管理模板->Windows组件->远程桌面服务->远程桌面会话主机->远程会话环境
在右边选择将硬件图形适配器应用于所有远程桌面服务会话
右键编辑，选择已启用确定保存。
重启远程主机。
现在可以在远程桌面里运行需要GPU支持的应用了

提升传输帧率
RDP默认的帧率是30，可以设置为60帧传输
实际效果取决于客户端设置、网络环境等等因素
打开远程主机上的注册表编辑器 win+r输入regedit
找到HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations
在空白处右键->新建->DWORD（32位）值，命名为DWMFRAMEINTERVAL
双击刚添加的这一项，基数选择为十进制，数值数据填写15
确定保存，重启生效
```

### 28. fsck ext4 disk
error message:     

```
[ 5903.331828] sd 4:0:0:0: [sdb] Attached SCSI removable disk
[ 5911.746891] EXT4-fs (sdb1): ext4_check_descriptors: Checksum for group 1 failed (43829!=56479)
[ 5911.746897] EXT4-fs (sdb1): group descriptors corrupted!
```
fixed via:    

```
fsck.ext4 -fvy  /dev/sdb1
```

### 29. width height
55 <40

### 30. check ssd/hdd in linux
via:    

```
lsblk -d -o name,rota
NAME ROTA
sda     0
sdb     0
sdc     1
```

### 30. list all xsessions
Available session types can be found in /usr/share/xsessions/ for X and in /usr/share/wayland-sessions/ for Wayland.

### 31. gdm 6000 issue
Solved via:    

```
[dash@localhost ~]$ which X
/usr/bin/X
[dash@localhost ~]$ sudo vim /usr/bin/X
[dash@localhost ~]$ ls -l -h /usr/bin/X
lrwxrwxrwx. 1 root root 4 Sep 26  2022 /usr/bin/X -> Xorg
[dash@localhost ~]$ sudo rm -f /usr/bin/X
[dash@localhost ~]$ sudo vim /usr/bin/X
[dash@localhost ~]$ sudo netstat -anp | grep 6000
tcp        0      0 0.0.0.0:6000            0.0.0.0:*               LISTEN      4215/X              
tcp6       0      0 :::6000                 :::*                    LISTEN      4215/X              
[dash@localhost ~]$ sudo systemctl restart gdm
[dash@localhost ~]$ sudo netstat -anp | grep 6000
[dash@localhost ~]$ cat /usr/bin/X
#!/bin/bash
exec /usr/bin/Xorg "$@" -nolisten tcp
exit 0
```

### 32. centos issue
disk full, restart machine with a cdrom, press F11 for boot menu.    

![/images/2023_03_29_09_59_13_674x419.jpg](/images/2023_03_29_09_59_13_674x419.jpg)


### 33. zhaoxin gpu
![/images/2023_03_30_09_22_18_864x289.jpg](/images/2023_03_30_09_22_18_864x289.jpg)

https://www.zhaoxin.com/qdxz.aspx?nid=31&typeid=554

![/images/2023_03_30_09_26_10_864x617.jpg](/images/2023_03_30_09_26_10_864x617.jpg)

ubuntu guest, with qxl disabled. 
windows, no spice server, no qxl graphical card.  

### 34. sddm autologin
via:     

```
vim /etc/sddm.conf.d/autologin.conf
[Autologin]
User=john
Session=plasma
```

### 35. reboot for normal user(ubuntu18.04)
via:    

```
echo '[Remote SSH]
Identity=unix-user:userrer
Action=org.freedesktop.login1.*
ResultAny=yes
ResultInactive=yes
ResultActive=yes' | sudo tee /etc/polkit-1/localauthority/50-local.d/power.pkla
```

### 36. pivpn
create via:    

```
pivpn add
```
Then copy the configuration files to wireguards. 
