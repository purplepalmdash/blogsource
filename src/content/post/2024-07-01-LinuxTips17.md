+++
title= "LinuxTips17"
date = "2024-07-01T10:25:40+08:00"
description = "LinuxTips17"
keywords = ["Technology"]
categories = ["Technology"]
+++
### 1. liquorix kernel(zen)
Install on Ubuntu 22.04 via:       

```
curl -s 'https://liquorix.net/install-liquorix.sh' | sudo bash
```
### 2. pikvm for x86
Tips(comment the brltty related items and reboot, then ttyUSB0 is avaiable):    

```
sudo vim /usr/lib/udev/rules.d/85-brltty.rules
# ENV{PRODUCT}=="1a86/7523/*", ENV{BRLTTY_BRAILLE_DRIVER}="bm", GOTO="brltty_usb_run"
sudo systemctl mask brltty.path
sudo reboot
```
Change to ubuntu22.04 and solved the problem.    
### 3. socket 5 proxy
Open the proxy via:      

```
ssh -N -D 0.0.0.0:10000 dash@localhost
```
Then set the proxy in other machine for yum usage:      

```
$ vim /etc/yum.conf
#proxy=socks5://10.23.119.200:10000
```

### 4. ubuntu22.04 curl issue
Problem:     

```
OpenSSL Error messages: error:0A000126:SSL routines::unexpected eof while reading
```
solved via:     

```
apt remove curl
apt purge curl
apt-get update
apt-get install -y libssl-dev autoconf libtool make
cd /usr/local/src
wget https://curl.haxx.se/download/curl-7.88.1.zip
unzip curl-7.88.1.zip
cd curl-7.88.1
./buildconf
./configure --with-ssl 
make
sudo make install
sudo cp /usr/local/bin/curl /usr/bin/curl
sudo ldconfig
curl -V
```

### 5. nix-shell install
install via:     

```
nix-shell '<home-manager>' -A install --option substituters https://mirrors.ustc.edu.cn/nix-channels/store
```

### 6. Workingtips for nix on ubuntu
简单步骤:    

```
curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix | sh -s -- install
nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
nix-channel --update
nix-shell '<home-manager>' -A install
nix run home-manager/master -- init --switch 
sudo apt install seatd
sudo usermod -a -G video $USER
reboot
nix profile install github:guibou/nixGL --impure
home-manager switch --option substituters https://mirrors.ustc.edu.cn/nix-channels/store
sudo apt-get install -y pipewire pipewire-pulse
```
Also edit the limitation of `/etc/security/limits.conf`, as following.    

Modification for nix files:      

```
$ vim ~/.config/home-manager/hyprland.nix
                monitor=,1920x1080@60,auto,1
......
             master {
                 # See https://wiki.hyprland.org/Configuring/Master-Layout/ for more
# new_is_master = true
                 new_status = slave
$ vim ~/.config/home-manager/flake.nix
    #hyprland.url = "github:hyprwm/Hyprland";
    hyprland.url = "git+https://github.com/hyprwm/Hyprland?submodules=1";

```
### 7. limitation linux
enlarge via:    

```
 /etc/security/limits.conf, add

* soft nofile 1000001
* hard nofile 1000001
```

### 8. nix dconf issue
problem:    

```
Activating dconfSettings
dbus[13416]: Failed to start message bus: Configuration file needs one or more <listen> elements giving addresses
dbus-run-session: EOF reading address from bus daemon
```
Solved via:    

```
not solved, for centos's dbus is pretty old
### 9. pactrap archlinux
Can't Pacstrap because of "Corrupted" packages, solved via:     

```
pacman -Sy archlinux-keyring
sudo pacstrap -c /mnt base
```

### 10. nixos dhcpd issue
encounter following issue:      

```
       Failed assertions:
       - The option definition `services.dhcpd4' in `/nix/store/yq5mkfx3b97iczs5a6lhjm14gkjx9795-source/configuration.nix' no longer has any effect; please remove it.
       The dhcpd4 module has been removed because ISC DHCP reached its end of life.
       See https://www.isc.org/blogs/isc-dhcp-eol/ for details.
       Please switch to a different implementation like kea or dnsmasq.
```
switch to new implementation:     

### 11. sybench rocklinux
Install via:      

```
sudo yum install -y epel-release
sudo yum install ./sysbench.....
```

### 12. x0vncserver
Using x0vncserver for replacing nxplayer:      

```
$ sudo pacman -S tigervnc
$ vncpasswd
$ vim ~/.xprofile
x0vncserver -rfbauth ~/.vnc/passwd &
```

### 13. git clone via socks proxy
temp using socks proxy via:     

```
git -c "http.proxy=socks5h://127.0.0.1:21080" clone https://github.com/Limitex/ComfyUI-Diffusers.git
```

### 14. ignore ast kernel issue
issue:      

```
W: Possible missing firmware /lib/firmware/ast_dp501_fw.bin for module ast
```
Solved via:     

```
touch /lib/firmware/ast_dp501_fw.bin
update-initramfs -u -k all
```

### 15. watch sync status
via:      

```
watch -d grep -e Dirty: -e Writeback: /proc/meminfo

```

### 15. g++ update
via:     

```
 2019  sudo apt install -y g++-12
 2020  ls -la /usr/bin | grep g++
 2021  sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-11 10
 2022  sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-12 20
 2023  sudo update-alternatives --install /usr/bin/c++ c++ /usr/bin/g++ 30
```

### 16. set default opener
Install:     

```
perl-file-mimeinfo
Or 
perl538Packages.FileMimeInfo
```
Select the default opener for jpeg:     

```
mimeopen -d photo.jpeg
```

### 17. esxi usb nic
`https://avojak.com/blog/2024/01/17/installing-esxi-with-usb-nic/`, 参考。    



### 18. nixos citrix workspace
Download the tar file from citrix:     

```
sudo nixos-rebuild switch --option substituers https://mirror.sjtu.edu.cn/nix-channels/store
nix-prefetch-url file:///home/dash/Downloads/linuxx64-24.5.0.76.tar.gz
sudo nixos-rebuild switch --option substituers https://mirror.sjtu.edu.cn/nix-channels/store
```

### 19. Run llama3.1
Steps:       

```
 curl -fsSL https://ollama.com/install.sh | sh
ollama run llama3.1:8b
```

### 20. offline kubespray issues
Solved via:     

```
tar xzvf ../off.tar.gz 
cd kubespray-offline-2.25.0-0/
cd outputs/
./setup-container.sh && ./start-nginx.sh && ./setup-offline.sh && ./setup-py.sh && ./start-registry.sh && ./load-push-all-images.sh && ./extract-kubespray.sh
cd kubespray-2.25.0/
cd inventory/
cp -r sample/ rong
cd rong/
vim inventory.ini 
cd ../../
python3.11 -m venv ~/.venv/3.11
source ~/.venv/3.11/bin/activate
pip install -U pip
pip install -r requirements.txt 
cp ../../offline.yml inventory/rong/group_vars/all/offline.yml
vim inventory/rong/group_vars/all/offline.yml 
cp ~/new/kubespray-offline-2.25.0-0/outputs/playbook/offline-repo.yml .
cp -r ~/new/kubespray-offline-2.25.0-0/outputs/playbook/roles/offline-repo/ roles/
ansible-playbook -i inventory/rong/inventory.ini offline-repo.yml 
ansible-playbook -i inventory/rong/inventory.ini --become --become-user=root cluster.yml 
kubectl get nodes
kubectl get po --all-namespaces
vim /etc/systemd/resolved.conf
reboot
```

### 21. grep in linux root
via:    

```
grep -rli --exclude-dir={proc,boot,root,sys}  'xmlns:qemu=' /
```
